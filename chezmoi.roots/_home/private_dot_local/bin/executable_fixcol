#! /usr/bin/env bash

perl -pe'
    s/(^|:\[?)('"$(date +%Y)"'[[:digit:]T\-\:\.]{15,19})/:|$2:|/;
    s/:\|\] /:|/;
    s@^([^\.])@:|:|:|:|$1@;
    s@/([^/:]+):@:|$1:@;
    s@/([^/:]+):@:|$1:@;
    s/-172/:|172/;
    s/^(?<all>'`
#      `'(?<p1>([^|]+:\|)+[^:]+):\[?'`
#      `'((?<ts>[[:digit:]]{4}([- :,][[:digit:]]{2,3}){6})(\]|:) )?'`
#      `'(?<type>[A-Z]+)[\[ \/]+'`
#      `'(?<src>[^\/-]+)[\/]'`
#      `'(?<x>[^\]]+)'`
       `')/all:$+{all}\n$+{p1}:|$+{ts}:|$+{type}:|$+{src}:|$+{x}:|/;
    #     s/^(([^|]+:\|)+[^:]+):\[?(([[:digit:]]{4}([- :,][[:digit:]]{2,3}){6})(\]|:) )?(([A-Z]+)[ /]\[?([^/]+)/?)?/\1:|\4:|8:\8:|9:\9:|0:/;
    # s/^(([^|]+:\|)+[^:]+):\[?(([[:digit:]]{4}([- :,][[:digit:]]{2,3}){6})(\]|:) )?(([A-Z]+)[ /]([^]/]+)([^]/]+)?\] )?/\1:|\4:|\8:|\9:|/;
    # s/(\+00:00|\]):? /\1:|/g;
    # s/:\|([^:|\[]+ )/:|:|\1/;
    # s/\]:\|(:\|| )*/]:|/;
    # s/ (\(P[[:digit:]]+|[\{\[])/:|\1/g;
'

# vim: set ft=sh expandtab tabstop=4 shiftwidth=4:
