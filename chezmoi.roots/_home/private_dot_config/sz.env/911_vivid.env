#!/usr/bin/env -S bash -c 'echo "Not a user script. source(aka .) only"'

[[ -n "${DBG}" ]] && set -x

LS_COLORS_THEME=alabaster_dark
LS_COLORS_FALLBACK="$SZ_ENV_ROOT/lib/vivid.${LS_COLORS_THEME}.theme"
if is_cmd vivid && ! grep -q ':\*\.vivid=' <<<"$LS_COLORS"; then

    export LS_COLORS="$(vivid generate "${LS_COLORS_THEME}" | sed -Ee 's/^(.+:)*\*~=([^:]+)(.*)$/\1*~=\2\3:*.vivid=\2/')"

    [[ -n "${DBG}" ]] && echo "LS_COLORS loaded with vivid."

fi

# fallback LS_COLORS if vivid failed running or is missing
grep -q ':\*\.vivid=' <<<"$LS_COLORS" \
|| ! [ -r "$LS_COLORS_FALLBACK" ] \
|| export LS_COLORS="$(cat "${LS_COLORS_THEME}")" \
&& echo "$LS_COLORS" > "$LS_COLORS_FALLBACK"

[[ -n "${DBG}" ]] && set +x

# vim: set ft=sh expandtab tabstop=4 shiftwidth=4:
