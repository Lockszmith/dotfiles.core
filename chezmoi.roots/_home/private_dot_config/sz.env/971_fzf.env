#!/usr/bin/env -S bash -c 'echo "Not a user script. source(aka .) only"'

if ! is_cmd atuin && is_cmd load-fzf; then
    . <( load-fzf - )
fi

if is_cmd fzf; then

    # https://vastdata.slack.com/archives/C08V7FMQL6P/p1756178503061039
    ff() {
        pathfile='~/paths.list.txt'
        RG_PREFIX="rg --column --line-number --no-heading --color=always --smart-case "
        RG_PREFIX="rg --column --line-number --no-heading --smart-case "
            #--bind "ctrl-o:execute[/home/jw/tools/pfp.py -t 10s {+} -r 'PANIC.*|ALERT.*|FAIL.*|KILL.*|Stopping the.*|env_id.*$|NOTIFY.*|ERROR.*|WARNING.*' | zless -SRXcM+G ]" \
        fzf -e -x --layout=reverse --info=inline --multi --cycle \
            --preview "( echo '=== Head ===' && head -n10 {-1} | strings && echo -e '\n=== Tail ===' && tail -n30 {-1} | strings )" \
            --preview-window bottom:70% \
            --bind "esc:toggle-preview,enter:execute[zless -SRXcM+G {+}]" \
            --bind "ctrl-c:execute[echo $(realpath {+})]+abort" \
            --bind "ctrl-v:execute[vim {+}],ctrl-g:execute[echo $(realpath {+}) >> $pathfile && tail -1 $pathfile]+abort" \
            --bind "ctrl-d:execute[cat {+} | jq -C '.' | less -R]" \
            --bind "ctrl-t:change-prompt(Tree-> )+reload:tree -d -L 2 || true" \
            --bind "ctrl-r:change-prompt(RG-> )+reload:$RG_PREFIX {q}"
    }

fi

# vim: set ft=sh expandtab tabstop=4 shiftwidth=4:
