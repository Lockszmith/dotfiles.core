#!/usr/bin/env -S bash -c 'echo "Not a user script. source(aka .) only"'

if [[ -x "${CUSTOM_NVIM_PATH:-$HOME/.local/bin/nvim}" ]]; then
    fix_nvim () {
    CUSTOM_NVIM_PATH="${CUSTOM_NVIM_PATH:-$HOME/.local/bin/nvim}"
        printf '%s\n' \
            "update-alternatives --install /usr/bin/editor editor '${CUSTOM_NVIM_PATH}' 110" \
            "update-alternatives --install /usr/bin/edit edit '${CUSTOM_NVIM_PATH}' 110" \
            "update-alternatives --install /usr/bin/ex ex '${CUSTOM_NVIM_PATH}' 110" \
            "update-alternatives --install /usr/bin/vi vi '${CUSTOM_NVIM_PATH}' 110" \
            "update-alternatives --install /usr/bin/view view '${CUSTOM_NVIM_PATH}' 110" \
            "update-alternatives --install /usr/bin/vim vim '${CUSTOM_NVIM_PATH}' 110" \
            "update-alternatives --install /usr/bin/vimdiff vimdiff '${CUSTOM_NVIM_PATH}' 110" \
            "update-alternatives --set editor '${CUSTOM_NVIM_PATH}'" \
            "update-alternatives --set edit '${CUSTOM_NVIM_PATH}'" \
            "update-alternatives --set ex '${CUSTOM_NVIM_PATH}'" \
            "update-alternatives --set vi '${CUSTOM_NVIM_PATH}'" \
            "update-alternatives --set view '${CUSTOM_NVIM_PATH}'" \
            "update-alternatives --set vim '${CUSTOM_NVIM_PATH}'" \
            "update-alternatives --set vimdiff '${CUSTOM_NVIM_PATH}'"
    }
fi

nvim-cleanup () {
    local _cache_dirs=("$HOME/.local/share" "$HOME/.local/state")
    for cache_dir in "${_cache_dirs[@]}"; do
        [[ -n "$cache_dir" && -d "$cache_dir" ]] || continue

        find "$cache_dir" -maxdepth 1 -mindepth 1 -type d -iname 'nvim' -print0 | ${SUDO:-} xargs -r0t rm -fR
    done

    if [[ "$(find "$cache_dir" -maxdepth 1 -mindepth 1 -type d -iname '*nvim*' | wc -l)" -gt 0 ]]; then
        printf 'nvim cleanup failed to remove the cache directory, you might still have old nvim data around.\n'
    else
        printf 'nvim state has been cleaned up, you can now start it.\n'
    fi
}

unalias nvim 2>/dev/null || true
if is_cmd 'nvim-p'; then
    export VISUAL="$(command -v nvim-p)"
elif is_cmd nvim; then
    export VISUAL="$(command -v nvim)"
else
    export VISUAL="$(command -v  vim)"
fi

if [ -x "${VISUAL//\/bin//bin/squashfs-root/usr/bin}" ]; then
    export VISUAL="${VISUAL//\/bin//bin/squashfs-root/usr/bin}"
fi
export EDITOR="$VISUAL"

alias nvim="$EDITOR "
alias vi='nvim '
alias vim='nvim '
alias nvimdiff='nvim -d '
alias vimdiff='nvimdiff '

# vim: set ft=sh expandtab tabstop=4 shiftwidth=4:
